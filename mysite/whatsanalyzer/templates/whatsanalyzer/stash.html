<!DOCTYPE html>
<html lang="en">

{% load static %}

<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
<link rel="stylesheet" href="{% static 'css/file-picker.css' %}" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

<head>
    <meta charset="UTF-8">
    <title>File Picker</title>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-auth.js"></script>
</head>

<body>
    <script type="text/javascript">
        <!-- SETTING UP FIREBASE CREDENTIALS -->
        var firebaseConfig = {
              apiKey: "AIzaSyDhJD_AENniovRoVttwWmwaKwlpKuHyVck",
              authDomain: "whatsapp-27255.firebaseapp.com",
              databaseURL: "https://whatsapp-27255.firebaseio.com",
              projectId: "whatsapp-27255",
              storageBucket: "whatsapp-27255.appspot.com",
              messagingSenderId: "998524713961",
              appId: "1:998524713961:web:dedfaf0cc4d5710d65e978",
              measurementId: "G-T5B7QLDPKN"
          };

        // INITIALIZE FIREBASE MAIN APP AND START ANALYTICS
        firebase.initializeApp(firebaseConfig);

        // INITIALIZE REQUIRED FIREBASE REFERENCES
        var storageRef = firebase.storage().ref();


        <!-- COOKIE GETTER TO RETRIEVE CURRENT USER'S DISPLAY NAME -->
        // HELPER : COOKIE GETTER
        function getCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0;i < ca.length;i++) {
                var c = ca[i];
                while (c.charAt(0)==' ') c = c.substring(1,c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
            }
            return null;
        }

        // INITIALIZE REQUIRED FIREBASE REFERENCES
        var currentUserName = getCookie('currentUserName');


        // SETUP CLOUD DIRECTORY TO PULL FROM
        var folderRef = storageRef.child(currentUserName);
        var fileList = [];
        alert("folderRef : " + folderRef);

        // PULL ALL FILES BELONGING TO THE USER
        folderRef.listAll().then(function(res) {
          res.items.forEach(function(itemRef) {
              fileList.push(itemRef);
          });
          alert(fileList.join("\n"));
        }).catch(function(error) {
            alert("folderRef.listAll() FAILED");
        });
    </script>
    <div class="demo-card-square mdl-card mdl-shadow--2dp">
      <div class="mdl-card__title mdl-card--expand">
        <h2 class="mdl-card__title-text">Update</h2>
      </div>
      <div id="supporting_text_1" class="mdl-card__supporting-text">
        <!-- TODO : fileList VARIABLE IS INACCESSIBLE HERE + MAKE DYNAMIC LISTVIEW-->
<!--        HTML FOR LOOP TO GENERTE EACH CARD IN A BLOCK-->
          {{fileList}}
      </div>
      <div class="mdl-card__actions mdl-card--border">
        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">
          View Updates
        </a>
      </div>
    </div>
</body>
</html>